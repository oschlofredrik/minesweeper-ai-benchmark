<!DOCTYPE html>
<html>
<head>
    <title>Test Vercel AI SDK Complete</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .status {
            padding: 5px 10px;
            border-radius: 3px;
            display: inline-block;
        }
        .status.success { background: #4CAF50; color: white; }
        .status.error { background: #f44336; color: white; }
        .status.pending { background: #FF9800; color: white; }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            overflow: auto;
            max-height: 300px;
        }
        .event-log {
            background: #f0f0f0;
            padding: 10px;
            margin: 10px 0;
            max-height: 400px;
            overflow-y: auto;
        }
        .event-item {
            padding: 5px;
            margin: 2px 0;
            background: white;
            border-left: 3px solid #2196F3;
        }
    </style>
</head>
<body>
    <h1>Vercel AI SDK Complete Test Suite</h1>
    
    <!-- Test 1: Basic Streaming -->
    <div class="test-section">
        <h2>Test 1: Basic Game Streaming</h2>
        <p>Test single game with streaming updates</p>
        <button onclick="testBasicStreaming()">Run Test</button>
        <span id="test1-status" class="status pending">Not started</span>
        <div id="test1-events" class="event-log"></div>
        <pre id="test1-result"></pre>
    </div>
    
    <!-- Test 2: Competition Workflow -->
    <div class="test-section">
        <h2>Test 2: Tournament Competition</h2>
        <p>Test elimination tournament with multiple AI models</p>
        <button onclick="testTournament()">Run Test</button>
        <span id="test2-status" class="status pending">Not started</span>
        <pre id="test2-result"></pre>
    </div>
    
    <!-- Test 3: Team Collaboration -->
    <div class="test-section">
        <h2>Test 3: Team Collaboration</h2>
        <p>Test AI models working together as a team</p>
        <button onclick="testTeamGame()">Run Test</button>
        <span id="test3-status" class="status pending">Not started</span>
        <pre id="test3-result"></pre>
    </div>
    
    <!-- Test 4: SDK Feature Flags -->
    <div class="test-section">
        <h2>Test 4: Feature Flag Toggle</h2>
        <p>Test SDK enable/disable functionality</p>
        <div>
            <label>
                <input type="checkbox" id="sdk-enabled" checked>
                Use Vercel AI SDK
            </label>
        </div>
        <button onclick="testFeatureFlag()">Test Current Setting</button>
        <span id="test4-status" class="status pending">Not started</span>
        <pre id="test4-result"></pre>
    </div>
    
    <!-- Test 5: Performance Comparison -->
    <div class="test-section">
        <h2>Test 5: Performance Comparison</h2>
        <p>Compare SDK vs Legacy implementation</p>
        <button onclick="testPerformance()">Run Comparison</button>
        <span id="test5-status" class="status pending">Not started</span>
        <pre id="test5-result"></pre>
    </div>

    <script>
        // Test 1: Basic Streaming
        async function testBasicStreaming() {
            const statusEl = document.getElementById('test1-status');
            const resultEl = document.getElementById('test1-result');
            const eventsEl = document.getElementById('test1-events');
            
            statusEl.className = 'status pending';
            statusEl.textContent = 'Running...';
            eventsEl.innerHTML = '';
            
            try {
                const response = await fetch('/api/evaluate-sdk', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        gameType: 'minesweeper',
                        provider: 'openai',
                        model: 'gpt-4',
                        difficulty: 'easy',
                        numGames: 1,
                        streaming: true,
                        temperature: 0.7,
                        maxSteps: 20
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                // Handle streaming response
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let buffer = '';
                let moveCount = 0;
                
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    
                    buffer += decoder.decode(value, { stream: true });
                    const lines = buffer.split('\n');
                    buffer = lines.pop() || '';
                    
                    for (const line of lines) {
                        if (line.trim().startsWith('data: ')) {
                            const data = line.slice(6);
                            if (data === '[DONE]') continue;
                            
                            try {
                                const event = JSON.parse(data);
                                moveCount++;
                                
                                const eventDiv = document.createElement('div');
                                eventDiv.className = 'event-item';
                                eventDiv.innerHTML = `
                                    <strong>${event.type}</strong>: 
                                    ${event.type === 'move' ? `Move ${event.moveNumber} - ${event.action}` : event.message || ''}
                                `;
                                eventsEl.appendChild(eventDiv);
                                eventsEl.scrollTop = eventsEl.scrollHeight;
                                
                            } catch (e) {
                                console.error('Parse error:', e);
                            }
                        }
                    }
                }
                
                statusEl.className = 'status success';
                statusEl.textContent = 'Success';
                resultEl.textContent = `Streaming completed. Received ${moveCount} events.`;
                
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = 'Failed';
                resultEl.textContent = `Error: ${error.message}`;
            }
        }
        
        // Test 2: Tournament
        async function testTournament() {
            const statusEl = document.getElementById('test2-status');
            const resultEl = document.getElementById('test2-result');
            
            statusEl.className = 'status pending';
            statusEl.textContent = 'Running...';
            
            try {
                const response = await fetch('/api/competition-sdk', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        type: 'tournament',
                        name: 'Test Tournament',
                        gameType: 'minesweeper',
                        difficulty: 'easy',
                        roundFormat: 'best-of-3',
                        participants: [
                            { provider: 'openai', model: 'gpt-4', name: 'GPT-4' },
                            { provider: 'openai', model: 'gpt-3.5-turbo', name: 'GPT-3.5' },
                            { provider: 'anthropic', model: 'claude-3-opus', name: 'Claude-3' },
                            { provider: 'anthropic', model: 'claude-3-haiku', name: 'Claude-Haiku' }
                        ]
                    })
                });
                
                const result = await response.json();
                
                statusEl.className = 'status success';
                statusEl.textContent = 'Success';
                resultEl.textContent = JSON.stringify(result, null, 2);
                
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = 'Failed';
                resultEl.textContent = `Error: ${error.message}`;
            }
        }
        
        // Test 3: Team Game
        async function testTeamGame() {
            const statusEl = document.getElementById('test3-status');
            const resultEl = document.getElementById('test3-result');
            
            statusEl.className = 'status pending';
            statusEl.textContent = 'Running...';
            
            try {
                const response = await fetch('/api/competition-sdk', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        type: 'team',
                        gameType: 'minesweeper',
                        difficulty: 'medium',
                        team: {
                            name: 'AI Dream Team',
                            communicationStyle: 'sequential',
                            members: [
                                { provider: 'openai', model: 'gpt-4', role: 'strategist', name: 'GPT-4 Strategist' },
                                { provider: 'anthropic', model: 'claude-3-opus', role: 'analyst', name: 'Claude Analyst' },
                                { provider: 'openai', model: 'gpt-3.5-turbo', role: 'executor', name: 'GPT-3.5 Executor' }
                            ]
                        }
                    })
                });
                
                const result = await response.json();
                
                statusEl.className = 'status success';
                statusEl.textContent = 'Success';
                resultEl.textContent = JSON.stringify(result, null, 2);
                
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = 'Failed';
                resultEl.textContent = `Error: ${error.message}`;
            }
        }
        
        // Test 4: Feature Flag
        async function testFeatureFlag() {
            const statusEl = document.getElementById('test4-status');
            const resultEl = document.getElementById('test4-result');
            const useSDK = document.getElementById('sdk-enabled').checked;
            
            statusEl.className = 'status pending';
            statusEl.textContent = 'Testing...';
            
            // Set feature flag
            localStorage.setItem('USE_VERCEL_SDK', useSDK ? 'true' : 'false');
            
            try {
                const response = await fetch('/api/benchmark/run', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        game: 'minesweeper',
                        provider: 'openai',
                        model: 'gpt-4',
                        difficulty: 'easy',
                        num_games: 1
                    })
                });
                
                const responseText = await response.text();
                const isUsingSDK = responseText.includes('evaluate-sdk') || 
                                  response.headers.get('x-sdk-used') === 'true';
                
                statusEl.className = 'status success';
                statusEl.textContent = 'Success';
                resultEl.textContent = `SDK Enabled: ${useSDK}\nActually Using SDK: ${isUsingSDK}\nMatch: ${useSDK === isUsingSDK ? 'YES' : 'NO'}`;
                
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = 'Failed';
                resultEl.textContent = `Error: ${error.message}`;
            }
        }
        
        // Test 5: Performance Comparison
        async function testPerformance() {
            const statusEl = document.getElementById('test5-status');
            const resultEl = document.getElementById('test5-result');
            
            statusEl.className = 'status pending';
            statusEl.textContent = 'Running comparison...';
            
            const results = {
                legacy: { time: 0, success: false },
                sdk: { time: 0, success: false }
            };
            
            try {
                // Test Legacy
                localStorage.setItem('USE_VERCEL_SDK', 'false');
                const legacyStart = Date.now();
                const legacyResponse = await fetch('/api/benchmark/run', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        game: 'minesweeper',
                        provider: 'openai',
                        model: 'gpt-4',
                        difficulty: 'easy',
                        num_games: 1
                    })
                });
                results.legacy.time = Date.now() - legacyStart;
                results.legacy.success = legacyResponse.ok;
                
                // Test SDK
                localStorage.setItem('USE_VERCEL_SDK', 'true');
                const sdkStart = Date.now();
                const sdkResponse = await fetch('/api/benchmark/run', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        game: 'minesweeper',
                        provider: 'openai',
                        model: 'gpt-4',
                        difficulty: 'easy',
                        num_games: 1
                    })
                });
                results.sdk.time = Date.now() - sdkStart;
                results.sdk.success = sdkResponse.ok;
                
                const speedup = results.legacy.time / results.sdk.time;
                
                statusEl.className = 'status success';
                statusEl.textContent = 'Completed';
                resultEl.textContent = `Performance Comparison:
                
Legacy Implementation:
- Time: ${results.legacy.time}ms
- Success: ${results.legacy.success}

SDK Implementation:
- Time: ${results.sdk.time}ms  
- Success: ${results.sdk.success}

Speedup: ${speedup.toFixed(2)}x ${speedup > 1 ? 'faster' : 'slower'}`;
                
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = 'Failed';
                resultEl.textContent = `Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>